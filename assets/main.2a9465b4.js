var P=Object.defineProperty;var b=(s,t,o)=>t in s?P(s,t,{enumerable:!0,configurable:!0,writable:!0,value:o}):s[t]=o;var w=(s,t,o)=>(b(s,typeof t!="symbol"?t+"":t,o),o);import"./modulepreload-polyfill.c7c6310f.js";const r=40,l=30;function g(s,t){return s.x==t.x&&s.y==t.y}function A(s,t,o){s.shadowColor=o,s.shadowBlur=20,s.fillStyle=o,s.fillRect(t.x,t.y,1,1)}const z=Number(new URLSearchParams(location.search).get("players"))||2,f=async s=>{const t=navigator.keyboard;return t&&(await t.getLayoutMap()).get(`Key${s.toUpperCase()}`)||s},D=async()=>{const s={left:"arrowleft",up:"arrowup",right:"arrowright",down:"arrowdown"};return z===1?[new x({x:r/2,y:l/2},s,[0,255,0],20)]:[new x({x:r/4,y:l/2},{left:await f("a"),up:await f("w"),right:await f("d"),down:await f("s")},[255,0,0],20),new x({x:r/4*3,y:l/2},s,[255,125,0],20),new x({x:r/2,y:l/2},{left:await f("g"),up:await f("y"),right:await f("j"),down:await f("h")},[0,255,0],20)].slice(0,z)};class x{constructor(t,o,h,p=1){w(this,"dir",null);w(this,"nextDir",null);w(this,"tail",[]);w(this,"size",10);this.pos=t,this.controls=o,this.color=h,this.shrinkSize=p,document.addEventListener("keydown",a=>{const n=a.key.toLocaleLowerCase();let u=0,c=0;if(n===this.controls.left)u=-1;else if(n==this.controls.up)c=-1;else if(n===this.controls.right)u=1;else if(n===this.controls.down)c=1;else if(n==="Space"){this.dir=null;return}else return;this.dir!=null&&(this.dir.x&&u||this.dir.y&&c)||(this.dir={x:u,y:c},this.nextDir=this.nextDir||this.dir)})}get points(){return[this.pos,...this.tail]}move(){if(!this.dir)return;const t=this.nextDir||this.dir;this.nextDir=null,this.tail.unshift(this.pos),this.tail=this.tail.slice(0,this.size),this.pos={x:this.pos.x+t.x,y:this.pos.y+t.y},this.pos.x=(this.pos.x+r)%r,this.pos.y=(this.pos.y+l)%l}draw(t){this.points.forEach((o,h)=>{const a=.4+(1-h/this.points.length)*.6;A(t,o,`rgba(${this.color.map(n=>`${n}`).join()}, ${a}`)})}}class L{constructor(t,o,h){this.pos=t,this.size=o,this.color=h}}function R(){let t=[],o=[],h=!1,p,a=0,n=0;function u(){return Math.random()<.1?c(20,"#ff0"):c(3,"#09fb")}function c(i,M){const S=t.flatMap(e=>e.points);for(;;){const e={x:Math.floor(Math.random()*r),y:Math.floor(Math.random()*l)};if(!S.some(F=>g(F,e)))return new L(e,i,M)}}const y=document.createElement("canvas");document.body.appendChild(y),y.width=r*15,y.height=l*15;const d=y.getContext("2d");d.scale(15,15),k();let m=0;function E(i){for(m=m||i;m<=i;)C(),m+=p;v(),requestAnimationFrame(E)}requestAnimationFrame(E);function C(){if(!!h){if(a++,n){a>=n&&k();return}a%20===0&&t.forEach(i=>i.size--),t.forEach(i=>i.move());for(const i of t)([...i.tail,...t.filter(e=>e!==i).flatMap(e=>e.points)].some(e=>g(e,i.pos))||i.pos.x!==(i.pos.x+r)%r||i.pos.y!==(i.pos.y+l)%l)&&(i.size-=i.shrinkSize),o.filter(e=>g(i.pos,e.pos)).forEach(e=>{delete o[o.indexOf(e)],e.size>0&&o.push(u()),i.size+=e.size});t=t.filter(i=>i.size>=0),a%500===0&&[...Array(9)].forEach(()=>o.push(c(-9,"#c0f"))),a%100===0&&(p=p*.98),t.length<=(z===1?0:1)&&!n&&(n=a+20)}}async function k(){h=!1,t=await D(),o=[...Array(8)].map(u),p=100,a=0,h=!0,n=0}function v(){d.fillStyle="#000",d.fillRect(0,0,r,l),t.forEach(i=>i.draw(d)),o.forEach(i=>A(d,i.pos,i.color))}}R();
