var P=Object.defineProperty;var C=(i,t,o)=>t in i?P(i,t,{enumerable:!0,configurable:!0,writable:!0,value:o}):i[t]=o;var y=(i,t,o)=>(C(i,typeof t!="symbol"?t+"":t,o),o);(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))l(s);new MutationObserver(s=>{for(const r of s)if(r.type==="childList")for(const n of r.addedNodes)n.tagName==="LINK"&&n.rel==="modulepreload"&&l(n)}).observe(document,{childList:!0,subtree:!0});function o(s){const r={};return s.integrity&&(r.integrity=s.integrity),s.referrerpolicy&&(r.referrerPolicy=s.referrerpolicy),s.crossorigin==="use-credentials"?r.credentials="include":s.crossorigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function l(s){if(s.ep)return;s.ep=!0;const r=o(s);fetch(s.href,r)}})();const c=40,f=30;function x(i,t){return i.x==t.x&&i.y==t.y}function S(i,t,o){i.shadowColor=o,i.shadowBlur=20,i.fillStyle=o,i.fillRect(t.x,t.y,1,1)}const z=Number(new URLSearchParams(location.search).get("players"))||2,u=async i=>{const t=navigator.keyboard;return t&&(await t.getLayoutMap()).get(`Key${i.toUpperCase()}`)||i},F=async()=>{const i={left:"arrowleft",up:"arrowup",right:"arrowright",down:"arrowdown"};return z===1?[new g({x:c/2,y:f/2},i,[0,255,0],20)]:[new g({x:c/4,y:f/2},{left:await u("a"),up:await u("w"),right:await u("d"),down:await u("s")},[255,0,0],20),new g({x:c/4*3,y:f/2},i,[255,125,0],20),new g({x:c/2,y:f/2},{left:await u("g"),up:await u("y"),right:await u("j"),down:await u("h")},[0,255,0],20)].slice(0,z)};class g{constructor(t,o,l,s=1){y(this,"dir",null);y(this,"nextDir",null);y(this,"tail",[]);y(this,"size",10);this.pos=t,this.controls=o,this.color=l,this.shrinkSize=s,document.addEventListener("keydown",r=>{const n=r.key.toLocaleLowerCase();let d=0,h=0;if(n===this.controls.left)d=-1;else if(n==this.controls.up)h=-1;else if(n===this.controls.right)d=1;else if(n===this.controls.down)h=1;else if(n==="Space"){this.dir=null;return}else return;this.dir!=null&&(this.dir.x&&d||this.dir.y&&h)||(this.dir={x:d,y:h},this.nextDir=this.nextDir||this.dir)})}get points(){return[this.pos,...this.tail]}move(){if(!this.dir)return;const t=this.nextDir||this.dir;this.nextDir=null,this.tail.unshift(this.pos),this.tail=this.tail.slice(0,this.size),this.pos={x:this.pos.x+t.x,y:this.pos.y+t.y},this.pos.x=(this.pos.x+c)%c,this.pos.y=(this.pos.y+f)%f}draw(t){this.points.forEach((o,l)=>{const r=.4+(1-l/this.points.length)*.6;S(t,o,`rgba(${this.color.map(n=>`${n}`).join()}, ${r}`)})}}class D{constructor(t,o,l){this.pos=t,this.size=o,this.color=l}}function O(){let t=[],o=[],l=!1,s,r=0,n=0;function d(){return Math.random()<.1?h(20,"#ff0"):h(3,"#09fb")}function h(e,k){const M=t.flatMap(a=>a.points);for(;;){const a={x:Math.floor(Math.random()*c),y:Math.floor(Math.random()*f)};if(!M.some(A=>x(A,a)))return new D(a,e,k)}}const m=document.createElement("canvas");document.body.appendChild(m),m.width=c*15,m.height=f*15;const p=m.getContext("2d");p.scale(15,15),L();let w=0;function E(e){for(w=w||e;w<=e;)b(),w+=s;v(),requestAnimationFrame(E)}requestAnimationFrame(E);function b(){if(!!l){if(r++,n){r>=n&&L();return}r%20===0&&t.forEach(e=>e.size--),t.forEach(e=>e.move());for(const e of t)([...e.tail,...t.filter(a=>a!==e).flatMap(a=>a.points)].some(a=>x(a,e.pos))||e.pos.x!==(e.pos.x+c)%c||e.pos.y!==(e.pos.y+f)%f)&&(e.size-=e.shrinkSize),o.filter(a=>x(e.pos,a.pos)).forEach(a=>{delete o[o.indexOf(a)],a.size>0&&o.push(d()),e.size+=a.size});t=t.filter(e=>e.size>=0),r%500===0&&[...Array(9)].forEach(()=>o.push(h(-9,"#c0f"))),r%100===0&&(s=s*.98),t.length<=(z===1?0:1)&&!n&&(n=r+20)}}async function L(){l=!1,t=await F(),o=[...Array(8)].map(d),s=100,r=0,l=!0,n=0}function v(){p.fillStyle="#000",p.fillRect(0,0,c,f),t.forEach(e=>e.draw(p)),o.forEach(e=>S(p,e.pos,e.color))}}O();
